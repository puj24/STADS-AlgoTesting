q_ref = [
    -0.006981160507910  0.009004995086066  0.670073830742302  0.742202937108952]'
%  -0.006921034442372  0.010524842372638  0.670865916642967  0.741466838269357 ]'
% -0.006741446737192  0.012151822170488  0.671656232944096  0.740732604046443 ]'
% -0.006652069522311  0.013698680448194  0.672445915714750  0.739989564648473 ]'
% -0.006650875288642  0.015160743796429  0.673233578049192  0.739243619407425 ]'
% -0.006420144756697  0.016832636303016  0.674015633303240  0.738496820894044 ]'
% -0.006432748745293  0.018282892193616  0.674801399485219  0.737743595557968 ]'
% -0.006317405697370  0.019844593537183  0.675585838486837  0.736987148199991 ]'
% -0.006224656445233  0.021387924489478  0.676364101702352  0.736230530379596 ]'
% -0.006071563942432  0.022983607029135  0.677142838256334  0.735467485944844 ]'

q_esti = [
    -0.006962292859414  0.009021251808280  0.670075679965325  0.742205312885003]' %10.2707 error
% -0.006901620486420  0.010542562667987  0.670867549054474  0.741469720204122 ]'
% -0.006673386873906  0.012213862504089  0.671652671440872  0.740730515245049 ]'
% -0.006621069288577  0.013726058213590  0.672444244932595  0.739989352022798 ]'
% -0.006657669322533  0.015154594639927  0.673233583001291  0.739244577862780 ]'
% -0.006420144756697  0.016832636303016  0.674015633303240  0.738496820894044 ]'
% -0.006374449193497  0.018334132076271  0.674800968390597  0.737744417469469 ]'
% -0.006381260939573  0.019790177947078  0.675587126604208  0.736986874663067 ]'
% -0.006224656445233  0.021387924489478  0.676364101702352  0.736230530379596 ]'
% -0.006078000855663  0.022977665052740  0.677143026652639  0.735467450560397]'

%calculating the 4,3 matrix used to calculate the error quaternion
some_matrix = [q_esti(4) -q_esti(3) q_esti(2); q_esti(3) q_esti(4) -q_esti(1); -q_esti(2) q_esti(1) q_esti(4); -q_esti(1) -q_esti(2) -q_esti(3)];


%error quaternion
error_quat = zeros(1,4);
error_quat(2:4) = ((1/(norm(q_esti)^2))*(some_matrix')*(q_ref))';
error_quat(1) = (1/(norm(q_esti)^2))*(q_esti')*(q_ref);    


%euler angles
eu = zeros(1,3);
[eu(1), eu(2), eu(3)] = quat2angle(error_quat);


final_error = [abs(rad2deg(eu(1))*3600) abs(rad2deg(eu(2))*3600) abs(rad2deg(eu(3))*3600) max([abs(rad2deg(eu(1))*3600) abs(rad2deg(eu(2))*3600) abs(rad2deg(eu(3))*3600)])];

disp(final_error(:,4))
